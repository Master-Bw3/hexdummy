{% from "macros/mappings.jinja" import mappings with context -%}

// A convention plugin that should be applied to all Minecraft-related subprojects, including {{ common_path }}.

package {{ modid }}

import kotlin.io.path.div

plugins {
    id("{{ modid }}.kotlin")
    id("{{ modid }}.utils.json5")

    `maven-publish`
    id("dev.architectury.loom")
}

val modId: String by project
val platform: String by project

base.archivesName = "${modId}-$platform"

loom {
    silentMojangMappingsLicense()
    accessWidenerPath = project(":{{ common_path }}").file("src/main/resources/{{ modid }}.accesswidener")
}

dependencies {
    minecraft(libs.minecraft)

    {{ mappings(
        mojmap=
    "mappings(loom.layered {
        officialMojangMappings()
        parchment(libs.parchment)
    })",
        yarn="mappings(libs.yarn)",
    ) }}

    annotationProcessor(libs.bundles.asm)
}

sourceSets {
    main {
        kotlin {
            srcDir(file("src/main/java"))
        }
        resources {
            srcDir(file("src/generated/resources"))
        }
    }
}

tasks {
    val artifactsTask = register<Copy>("githubArtifacts") {
        from(remapJar, remapSourcesJar, get("javadocJar"))
        into(rootDir.toPath() / "build" / "githubArtifacts")
    }

    build {
        dependsOn(artifactsTask)
    }
}
